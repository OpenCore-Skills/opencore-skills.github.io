<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenCORE-Skills Catalog</title>
    <style>
        /* General Style */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f6f8fa;
            color: #24292e;
        }
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            border-bottom: 1px solid #e1e4e8;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        header h1 {
            margin: 0;
            color: #0366d6;
        }
        header p {
            margin: 5px 0 0;
            font-size: 1.1em;
            color: #586069;
        }

        /* Search Controls */
        #controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px; /* Reduced margin */
        }
        .search-group {
            display: flex;
            flex-direction: column;
        }
        .search-group label {
            font-weight: 600;
            margin-bottom: 5px;
        }
        .search-group input {
            padding: 10px;
            font-size: 1em;
            border: 1px solid #d1d5da;
            border-radius: 6px;
        }

        /* --- NEW: Checklist Styles --- */
        #checklist-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .checklist-group h3 {
            margin: 0 0 8px;
            font-weight: 600;
            font-size: 1em;
            color: #586069;
        }
        .tag-checklist {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            background-color: #fff;
            border: 1px solid #d1d5da;
            padding: 10px;
            border-radius: 6px;
            min-height: 40px;
        }
        .check-tag {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
            background-color: #f6f8fa;
            color: #444;
            border: 1px solid #d1d5da;
            cursor: pointer;
            transition: all 0.1s;
            user-select: none; /* Prevents text selection on click */
        }
        .check-tag.selected {
            background-color: #0366d6;
            color: #fff;
            border-color: #0366d6;
        }
        .check-tag:hover {
            opacity: 0.8;
        }
        /* --- End NEW --- */


        /* Skill List */
        #skill-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        .skill-card {
            background-color: #fff;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 20px;
            transition: box-shadow 0.2s;
        }
        .skill-card:hover {
            box-shadow: 0 3px 6px rgba(149,157,165,0.2);
        }
        .skill-card h3 {
            margin: 0 0 10px;
            color: #0366d6;
            font-family: Consolas, "Courier New", monospace;
        }
        .skill-card p {
            margin: 0 0 15px;
        }
        .skill-card .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .skill-card .domain-tags {
            margin-bottom: 8px;
        }
        .skill-card .tag {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
        }
        .skill-card .tag-domain {
            background-color: #f0f8ff; /* Light Blue */
            color: #0366d6;
        }
        .skill-card .tag-mission {
            background-color: #f3f9f0; /* Light Green */
            color: #22863a;
        }
        .skill-card .tag:hover {
            cursor: pointer;
            opacity: 0.8;
            text-decoration: underline;
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>OpenCORE-Skills</h1>
            <p>COllaborative REpository for Physical AI and Robotics Skills</p>
        </header>

        <section id="controls">
            <div class="search-group">
                <label for="search-name">Search by Name</label>
                <input type="text" id="search-name" placeholder="e.g. 'pick'">
            </div>
            <div class="search-group">
                <label for="search-domain">Search by Domain Tag</label>
                <input type="text" id="search-domain" placeholder="e.g. 'manipulation, hri'">
            </div>
            <div class="search-group">
                <label for="search-mission">Search by Mission Tag</label>
                <input type="text" id="search-mission" placeholder="e.g. 'logistics'">
            </div>
        </section>

        <section id="checklist-container">
            <div class="checklist-group">
                <h3>Domain Tags</h3>
                <div id="domain-checklist" class="tag-checklist">
                    </div>
            </div>
            <div class="checklist-group">
                <h3>Mission Tags</h3>
                <div id="mission-checklist" class="tag-checklist">
                    </div>
            </div>
        </section>
        <main id="skill-list">
            </main>
    </div>

    <template id="skill-card-template">
        <article class="skill-card">
            <h3 class="skill-name"></h3>
            <p class="skill-description"></p>
            <div class="tag-container domain-tags"></div>
            <div class="tag-container mission-tags"></div>
        </article>
    </template>


    <script>
        // --- 1. SKILL DATA (Mockup) ---
        const skills = [
            { name: "pick", domain_tags: ["manipulation", "grasping"], mission_tags: ["pick_and_place", "bin_picking", "logistics"], description: "Senses and grasps a target object from a specified location." },
            { name: "place", domain_tags: ["manipulation", "grasping"], mission_tags: ["pick_and_place", "assembly", "sorting"], description: "Releases a currently held object at a specified target pose." },
            { name: "navigate", domain_tags: ["navigation", "mobility"], mission_tags: ["logistics", "transport", "exploration"], description: "Moves the robot base from its current location to a target destination." },
            { name: "inspect", domain_tags: ["inspection", "vision", "quality_control"], mission_tags: ["quality_assurance", "anomaly_detection"], description: "Performs a visual check on a target part to detect defects or anomalies." },
            { name: "handover", domain_tags: ["hri", "manipulation", "collaboration"], mission_tags: ["assistance", "assembly", "human_robot_interaction"], description: "Safely offers a held object to a human operator or takes an object from them." },
            { name: "follow", domain_tags: ["hri", "navigation", "collaboration", "mobility"], mission_tags: ["assistance", "logistics", "human_robot_interaction"], description: "Follows a designated human operator while maintaining a safe distance." },
            { name: "weld", domain_tags: ["process", "manufacturing", "manipulation"], mission_tags: ["welding", "assembly", "fabrication"], description: "Executes a welding path on a target seam using a dedicated tool." },
            { name: "screw", domain_tags: ["process", "manufacturing", "manipulation", "assembly"], mission_tags: ["screwing", "assembly", "electronics"], description: "Uses a tool to apply torque and fasten a screw at a specified location." },
            { name: "scan", domain_tags: ["inspection", "navigation", "perception"], mission_tags: ["mapping", "quality_control", "exploration", "3d_modelling"], description: "Creates a 3D model, point cloud, or 2D map of an area or object." },
            { name: "avoid", domain_tags: ["navigation", "safety", "perception", "mobility"], mission_tags: ["dynamic_obstacle_avoidance", "safety_protocol"], description: "Actively avoids dynamic and static obstacles while performing a primary mission." }
        ];

        // --- 2. DOM REFERENCES ---
        const searchNameInput = document.getElementById('search-name');
        const searchDomainInput = document.getElementById('search-domain');
        const searchMissionInput = document.getElementById('search-mission');
        const skillListContainer = document.getElementById('skill-list');
        const skillCardTemplate = document.getElementById('skill-card-template');
        
        // NEW: Checklist references
        const domainChecklistContainer = document.getElementById('domain-checklist');
        const missionChecklistContainer = document.getElementById('mission-checklist');
        
        // --- 3. GLOBAL STATE (for checklists) ---
        let allDomainTags = [];
        let allMissionTags = [];

        // --- 4. RENDERING & FILTERING FUNCTIONS ---

        /**
         * Renders a list of skills into the container.
         * (Identical to previous version, but adds tag click listeners)
         */
        function renderSkills(skillsToRender) {
            skillListContainer.innerHTML = ''; // Clear current list

            if (skillsToRender.length === 0) {
                skillListContainer.innerHTML = '<p>No skills found matching your criteria.</p>';
                return;
            }

            skillsToRender.forEach(skill => {
                const card = skillCardTemplate.content.cloneNode(true);
                card.querySelector('.skill-name').textContent = skill.name;
                card.querySelector('.skill-description').textContent = skill.description;

                const domainContainer = card.querySelector('.domain-tags');
                skill.domain_tags.forEach(tag => {
                    const tagElement = document.createElement('span');
                    tagElement.className = 'tag tag-domain';
                    tagElement.textContent = tag;
                    tagElement.addEventListener('click', () => handleTagClick(tag, 'domain'));
                    domainContainer.appendChild(tagElement);
                });

                const missionContainer = card.querySelector('.mission-tags');
                skill.mission_tags.forEach(tag => {
                    const tagElement = document.createElement('span');
                    tagElement.className = 'tag tag-mission';
                    tagElement.textContent = tag;
                    tagElement.addEventListener('click', () => handleTagClick(tag, 'mission'));
                    missionContainer.appendChild(tagElement);
                });

                skillListContainer.appendChild(card);
            });
        }

        /**
         * MODIFIED: Filters the skill list based on the search inputs.
         * Now supports comma-separated values.
         */
        function filterAndRender() {
            const nameQuery = searchNameInput.value.toLowerCase().trim();
            
            // Get comma-separated queries and turn them into arrays
            const domainQueries = searchDomainInput.value.split(',')
                .map(q => q.trim().toLowerCase()).filter(q => q.length > 0);
            
            const missionQueries = searchMissionInput.value.split(',')
                .map(q => q.trim().toLowerCase()).filter(q => q.length > 0);

            const filteredSkills = skills.filter(skill => {
                const nameMatch = nameQuery === '' || skill.name.toLowerCase().includes(nameQuery);

                // NEW LOGIC: Use .every() to check if ALL tags in the query are present
                const domainMatch = domainQueries.length === 0 || domainQueries.every(queryTag =>
                    skill.domain_tags.some(skillTag => skillTag.toLowerCase().includes(queryTag))
                );

                const missionMatch = missionQueries.length === 0 || missionQueries.every(queryTag =>
                    skill.mission_tags.some(skillTag => skillTag.toLowerCase().includes(queryTag))
                );
                
                return nameMatch && domainMatch && missionMatch;
            });

            renderSkills(filteredSkills);
        }

        // --- 5. NEW: CHECKLIST FUNCTIONS ---

        /**
         * Finds all unique tags and populates the checklist boxes.
         */
        function populateChecklists() {
            // Use Set for automatic de-duplication
            const domainTagSet = new Set(skills.flatMap(s => s.domain_tags));
            const missionTagSet = new Set(skills.flatMap(s => s.mission_tags));
            
            // Convert to sorted arrays
            allDomainTags = [...domainTagSet].sort();
            allMissionTags = [...missionTagSet].sort();
            
            // Create and append tag elements
            allDomainTags.forEach(tag => {
                const tagEl = document.createElement('span');
                tagEl.className = 'check-tag';
                tagEl.textContent = tag;
                tagEl.addEventListener('click', () => handleChecklistClick(tagEl, 'domain'));
                domainChecklistContainer.appendChild(tagEl);
            });
            
            allMissionTags.forEach(tag => {
                const tagEl = document.createElement('span');
                tagEl.className = 'check-tag';
                tagEl.textContent = tag;
                tagEl.addEventListener('click', () => handleChecklistClick(tagEl, 'mission'));
                missionChecklistContainer.appendChild(tagEl);
            });
        }
        
        /**
         * Handles a user clicking on a checklist tag.
         * @param {HTMLElement} tagElement - The tag element that was clicked.
         * @param {string} tagType - 'domain' or 'mission'.
         */
        function handleChecklistClick(tagElement, tagType) {
            tagElement.classList.toggle('selected');
            updateSearchFromChecklist(tagType);
        }

        /**
         * Reads the selected tags from a checklist and updates the corresponding search input.
         * @param {string} tagType - 'domain' or 'mission'.
         */
        function updateSearchFromChecklist(tagType) {
            let container, input;
            if (tagType === 'domain') {
                container = domainChecklistContainer;
                input = searchDomainInput;
            } else {
                container = missionChecklistContainer;
                input = searchMissionInput;
            }
            
            const selectedTags = [...container.querySelectorAll('.check-tag.selected')]
                .map(tagEl => tagEl.textContent);
            
            input.value = selectedTags.join(', ');
            filterAndRender(); // Re-filter results
        }
        
        /**
         * Reads the search input (comma-separated) and updates the checklist.
         * @param {string} tagType - 'domain' or 'mission'.
         */
        function updateChecklistFromSearch(tagType) {
            let container, input;
            if (tagType === 'domain') {
                container = domainChecklistContainer;
                input = searchDomainInput;
            } else {
                container = missionChecklistContainer;
                input = searchMissionInput;
            }
            
            const queries = input.value.split(',')
                .map(q => q.trim().toLowerCase()).filter(q => q.length > 0);
            
            container.querySelectorAll('.check-tag').forEach(tagEl => {
                const tagText = tagEl.textContent.toLowerCase();
                const isSelected = queries.includes(tagText);
                tagEl.classList.toggle('selected', isSelected);
            });
        }

        /**
         * Handles a user clicking on a tag *inside a skill card*.
         * @param {string} tagText - The text content of the tag.
         * @param {string} tagType - 'domain' or 'mission'.
         */
        function handleTagClick(tagText, tagType) {
            let input = (tagType === 'domain') ? searchDomainInput : searchMissionInput;
            
            const currentQueries = input.value.split(',')
                .map(q => q.trim().toLowerCase()).filter(q => q.length > 0);
            
            const newTag = tagText.toLowerCase();
            
            if (!currentQueries.includes(newTag)) {
                currentQueries.push(newTag);
            }
            
            input.value = currentQueries.join(', ');
            
            // Sync checklists and re-filter
            updateChecklistFromSearch(tagType);
            filterAndRender();
        }

        // --- 6. EVENT LISTENERS ---

        // Render everything on page load
        document.addEventListener('DOMContentLoaded', () => {
            populateChecklists(); // NEW
            renderSkills(skills);
        });

        // Add listeners to search inputs
        searchNameInput.addEventListener('input', filterAndRender);
        
        searchDomainInput.addEventListener('input', () => {
            updateChecklistFromSearch('domain');
            filterAndRender();
        });
        
        searchMissionInput.addEventListener('input', () => {
            updateChecklistFromSearch('mission');
            filterAndRender();
        });

    </script>
</body>
</html>
